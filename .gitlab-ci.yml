before_script:
    - export GOPATH=$HOME/go
    - export GOROOT=/usr/bin/go
    - export PATH=$GOROOT/bin:$GOPATH/bin:$PATH
    - go get github.com/constabulary/gb/...

stages:
    - test
    - build
    - deploy

format:
    stage: test
    script:
        - gb test -race -v

compile:
    stage: build
    script:
        - gb build

deploy_production:
    stage: deploy
    script:
        - sh build.sh
        - ls bin
        - docker-compose -f docker-compose.yml -f production.yml build
        - docker-compose -f docker-compose.yml -f production.yml up -d
    environment:
        name: production
    only:
        - master
